<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Speed Rush ‚Äì Arcade</title>
<style>
body{margin:0;background:#111;color:#fff;font-family:Arial;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh}
h1{margin:6px}
#hud{margin-bottom:6px}
canvas{background:#333;border:4px solid #fff;border-radius:12px}
.controls{display:flex;gap:15px;margin-top:10px}
button{padding:12px 18px;font-size:18px;border:none;border-radius:10px;cursor:pointer}
.overlay{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.7)}
.menu{background:#222;padding:30px;border-radius:16px;text-align:center}
.menu h2{margin-bottom:10px}
.menu button{width:200px;margin:8px 0}
#countdown{font-size:72px;font-weight:bold}
</style>
</head>
<body>
<h1>üöó Speed Rush</h1>
<div id="hud" style="display:none">
Score: <span id="score">0</span> |
Level: <span id="level">1</span>
</div>
<canvas id="game" width="360" height="600"></canvas>

<!-- START SCREEN -->
<div id="startScreen" class="overlay">
  <div class="menu">
    <h2>Speed Rush</h2>
    <p>Arcade + Pseudo-3D Racer</p>
    <button id="startBtn">‚ñ∂ Start Game</button>
  </div>
</div>

<!-- COUNTDOWN -->
<div id="countdownScreen" class="overlay" style="display:none">
  <div id="countdown">3</div>
</div>

<!-- GAME OVER -->
<div id="gameOverScreen" class="overlay" style="display:none">
  <div class="menu">
    <h2>Game Over</h2>
    <p>Score: <span id="finalScore">0</span></p>
    <button id="restartBtn">üîÑ Restart</button>
  </div>
</div>

<div class="controls" id="controls" style="display:none">
<button id="left">‚¨ÖÔ∏è</button>
<button id="nitro">üî• Nitro</button>
<button id="right">‚û°Ô∏è</button>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const scoreEl = document.getElementById('score');
const levelEl = document.getElementById('level');
const finalScoreEl = document.getElementById('finalScore');

const startScreen = document.getElementById('startScreen');
const countdownScreen = document.getElementById('countdownScreen');
const gameOverScreen = document.getElementById('gameOverScreen');
const controls = document.getElementById('controls');
const hud = document.getElementById('hud');
const countdownEl = document.getElementById('countdown');

let running = false;
let score = 0, level = 1;
let baseSpeed = 4;

const lanes = [60,155,250];
let currentLane = 1;
const car = { x: lanes[1], y: 460, w: 50, h: 95 };
const obstacles = [];

function drawRoad(){
  ctx.fillStyle='#444';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle='#fff';
  ctx.setLineDash([18,18]);
  lanes.forEach(l=>{
    ctx.beginPath();ctx.moveTo(l+25,0);ctx.lineTo(l+40,600);ctx.stroke();
  });
  ctx.setLineDash([]);
}

function drawCar(x,y,w,h,color){
  ctx.fillStyle='rgba(0,0,0,.4)';
  ctx.beginPath();ctx.ellipse(x+w/2,y+h+6,w/2,8,0,0,Math.PI*2);ctx.fill();

  ctx.fillStyle=color;
  ctx.beginPath();ctx.moveTo(x+6,y);ctx.lineTo(x+w-6,y);ctx.lineTo(x+w,y+h);ctx.lineTo(x,y+h);ctx.closePath();ctx.fill();

  ctx.fillStyle='rgba(200,230,255,.85)';
  ctx.fillRect(x+w*0.2,y+h*0.08,w*0.6,h*0.22);

  ctx.fillStyle='#111';
  [0.25,0.65].forEach(p=>{
    ctx.beginPath();ctx.arc(x-2,y+h*p,8,0,Math.PI*2);ctx.fill();
    ctx.beginPath();ctx.arc(x+w+2,y+h*p,8,0,Math.PI*2);ctx.fill();
  });
}

function spawnObstacle(){
  obstacles.push({
    lane:Math.floor(Math.random()*3),
    y:-140,
    w:50,
    h:Math.random()>0.7?130:95,
    color:'#1976d2'
  });
}

function gameOver(){
  running=false;
  finalScoreEl.textContent=score;
  gameOverScreen.style.display='flex';
}

function update(){
  if(!running) return;
  drawRoad();
  drawCar(car.x,car.y,car.w,car.h,'#d32f2f');

  for(let i=obstacles.length-1;i>=0;i--){
    const o=obstacles[i];
    o.y+=baseSpeed;
    drawCar(lanes[o.lane],o.y,o.w,o.h,o.color);

    if(o.y>600){
      obstacles.splice(i,1);
      score++;
      if(score%5===0) level++;
      scoreEl.textContent=score;
      levelEl.textContent=level;
    }

    if(Math.abs(lanes[o.lane]-car.x)<40 && Math.abs(o.y-car.y)<70){
      gameOver();return;
    }
  }
  requestAnimationFrame(update);
}

function startCountdown(){
  let count=3;
  countdownEl.textContent=count;
  countdownScreen.style.display='flex';
  const timer=setInterval(()=>{
    count--;
    if(count>0){countdownEl.textContent=count;}
    else{
      clearInterval(timer);
      countdownScreen.style.display='none';
      running=true;update();
    }
  },1000);
}

function startGame(){
  score=0;level=1;currentLane=1;
  obstacles.length=0;
  car.x=lanes[1];
  scoreEl.textContent=0;
  levelEl.textContent=1;
  startScreen.style.display='none';
  gameOverScreen.style.display='none';
  controls.style.display='flex';
  hud.style.display='block';
  startCountdown();
}

// BUTTON CONTROLS
left.onclick=()=>{if(currentLane>0){currentLane--;car.x=lanes[currentLane];}};
right.onclick=()=>{if(currentLane<2){currentLane++;car.x=lanes[currentLane];}};
nitro.onclick=()=>{baseSpeed+=2;setTimeout(()=>baseSpeed-=2,1200)};

// KEYBOARD CONTROLS (FIXED)
document.addEventListener('keydown',e=>{
  if(!running) return;
  if(e.key==='ArrowLeft' && currentLane>0){currentLane--;car.x=lanes[currentLane];}
  if(e.key==='ArrowRight' && currentLane<2){currentLane++;car.x=lanes[currentLane];}
});

startBtn.onclick=startGame;
restartBtn.onclick=startGame;

setInterval(()=>running && spawnObstacle(),1200);
</script>
</body>
</html>
